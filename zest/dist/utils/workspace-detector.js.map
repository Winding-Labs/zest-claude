{
  "version": 3,
  "sources": ["..\\src\\utils\\workspace-detector.ts", "..\\src\\utils\\logger.ts", "..\\src\\config\\constants.ts"],
  "sourcesContent": [
    "/**\r\n * Workspace detection utilities\r\n *\r\n * Detects current workspace and validates user access\r\n */\r\n\r\nimport { createHash } from \"node:crypto\";\r\nimport { basename, dirname, resolve } from \"node:path\";\r\nimport { logger } from \"./logger.js\";\r\n\r\nexport interface WorkspaceInfo {\r\n  id: string;\r\n  name: string;\r\n  path: string;\r\n}\r\n\r\n/**\r\n * Detect workspace from file path\r\n * For now, uses the directory containing the file as the workspace\r\n * In the future, this could integrate with Zest's workspace API\r\n */\r\nexport async function detectWorkspace(filePath: string): Promise<WorkspaceInfo | null> {\r\n  try {\r\n    // Get the directory of the file\r\n    const fileDir = dirname(filePath);\r\n    const absolutePath = resolve(fileDir);\r\n\r\n    // Find workspace root by looking for common markers\r\n    const workspaceRoot = await findWorkspaceRoot(absolutePath);\r\n\r\n    // Generate a deterministic workspace ID from the path\r\n    const workspaceId = generateWorkspaceId(workspaceRoot);\r\n    const workspaceName = getWorkspaceName(workspaceRoot);\r\n\r\n    return {\r\n      id: workspaceId,\r\n      name: workspaceName,\r\n      path: workspaceRoot,\r\n    };\r\n  } catch (error) {\r\n    logger.error(\"Failed to detect workspace:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Find the workspace root by looking for common markers\r\n * (.git, package.json, etc.)\r\n */\r\nasync function findWorkspaceRoot(startPath: string): Promise<string> {\r\n  const { existsSync } = await import(\"node:fs\");\r\n  const { join } = await import(\"node:path\");\r\n\r\n  let currentPath = startPath;\r\n  const root = resolve(\"/\");\r\n\r\n  // Look for workspace markers\r\n  const markers = [\".git\", \"package.json\", \"pnpm-workspace.yaml\", \"Cargo.toml\", \"go.mod\"];\r\n\r\n  while (currentPath !== root) {\r\n    for (const marker of markers) {\r\n      if (existsSync(join(currentPath, marker))) {\r\n        return currentPath;\r\n      }\r\n    }\r\n\r\n    // Move up one directory\r\n    const parentPath = dirname(currentPath);\r\n    if (parentPath === currentPath) break; // Reached root\r\n    currentPath = parentPath;\r\n  }\r\n\r\n  // If no marker found, use the start path\r\n  return startPath;\r\n}\r\n\r\n/**\r\n * Generate a deterministic workspace ID from path\r\n */\r\nfunction generateWorkspaceId(workspacePath: string): string {\r\n  // Create a hash of the absolute path for consistent ID\r\n  const hash = createHash(\"sha256\").update(workspacePath).digest(\"hex\");\r\n  return `workspace_${hash.substring(0, 16)}`;\r\n}\r\n\r\n/**\r\n * Get a human-readable workspace name from path\r\n */\r\nfunction getWorkspaceName(workspacePath: string): string {\r\n  return basename(workspacePath);\r\n}\r\n\r\n/**\r\n * Validate that user has access to workspace\r\n * For now, always returns true (will be implemented with Supabase in Step 7)\r\n */\r\nexport async function validateWorkspaceAccess(\r\n  workspaceId: string,\r\n  userId: string,\r\n): Promise<boolean> {\r\n  // TODO: Step 7 - Check workspace membership via Supabase\r\n  // For now, allow all workspaces\r\n  logger.debug(`Validating workspace access: ${workspaceId} for user ${userId}`);\r\n  return true;\r\n}\r\n",
    "/**\r\n * Logging utilities\r\n *\r\n * Handles logging to console and file system\r\n */\r\n\r\nimport { appendFile, mkdir } from \"node:fs/promises\";\r\nimport { dirname } from \"node:path\";\r\nimport { LOG_FILE } from \"../config/constants.js\";\r\n\r\ntype LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";\r\n\r\nclass Logger {\r\n  private minLevel: LogLevel = \"info\";\r\n\r\n  private levels: Record<LogLevel, number> = {\r\n    debug: 0,\r\n    info: 1,\r\n    warn: 2,\r\n    error: 3,\r\n  };\r\n\r\n  setLevel(level: LogLevel): void {\r\n    this.minLevel = level;\r\n  }\r\n\r\n  private async writeToFile(message: string): Promise<void> {\r\n    try {\r\n      await mkdir(dirname(LOG_FILE), { recursive: true });\r\n      const timestamp = new Date().toISOString();\r\n      await appendFile(LOG_FILE, `[${timestamp}] ${message}\\n`, \"utf-8\");\r\n    } catch (error) {\r\n      // Silently fail - don't crash if we can't write logs\r\n      console.error(\"Failed to write to log file:\", error);\r\n    }\r\n  }\r\n\r\n  private shouldLog(level: LogLevel): boolean {\r\n    return this.levels[level] >= this.levels[this.minLevel];\r\n  }\r\n\r\n  debug(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"debug\")) {\r\n      // Only write to file, don't clutter console\r\n      this.writeToFile(`DEBUG: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  info(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"info\")) {\r\n      // Only write to file, don't clutter console\r\n      this.writeToFile(`INFO: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  warn(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"warn\")) {\r\n      // Show warnings to user\r\n      console.warn(`[Zest:Warn] ${message}`, ...args);\r\n      this.writeToFile(`WARN: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  error(message: string, error?: unknown): void {\r\n    if (this.shouldLog(\"error\")) {\r\n      // Show errors to user\r\n      console.error(`[Zest:Error] ${message}`, error);\r\n      this.writeToFile(\r\n        `ERROR: ${message} ${error instanceof Error ? error.stack : JSON.stringify(error)}`,\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport const logger = new Logger();\r\n",
    "/**\r\n * Application constants and configuration values\r\n */\r\n\r\nimport { homedir } from \"node:os\";\r\nimport { join } from \"node:path\";\r\n\r\n// Base directories\r\nexport const CLAUDE_ZEST_DIR = join(homedir(), \".claude-zest\");\r\nexport const QUEUE_DIR = join(CLAUDE_ZEST_DIR, \"queue\");\r\nexport const LOGS_DIR = join(CLAUDE_ZEST_DIR, \"logs\");\r\nexport const STATE_DIR = join(CLAUDE_ZEST_DIR, \"state\");\r\n\r\n// File paths\r\nexport const SESSION_FILE = join(CLAUDE_ZEST_DIR, \"session.json\");\r\nexport const CONFIG_FILE = join(CLAUDE_ZEST_DIR, \"config.json\");\r\nexport const LOG_FILE = join(LOGS_DIR, \"plugin.log\");\r\n\r\n// Queue files\r\nexport const EVENTS_QUEUE_FILE = join(QUEUE_DIR, \"events.jsonl\");\r\nexport const SESSIONS_QUEUE_FILE = join(QUEUE_DIR, \"chat-sessions.jsonl\");\r\nexport const MESSAGES_QUEUE_FILE = join(QUEUE_DIR, \"chat-messages.jsonl\");\r\n\r\n// Platform and source identifiers\r\nexport const PLATFORM = \"terminal\";\r\nexport const SOURCE = \"claude-code\";\r\nexport const CLIENT_ID = \"claude-cli\";\r\n\r\n// Sync configuration\r\nexport const SYNC_INTERVAL_MS = 60000; // 60 seconds\r\nexport const MAX_RETRY_ATTEMPTS = 3;\r\nexport const RETRY_BACKOFF_MS = 5000;\r\n\r\n// Content size limits\r\nexport const MAX_DIFF_SIZE_BYTES = 10 * 1024 * 1024; // 10MB\r\nexport const MAX_CONTENT_PREVIEW_LENGTH = 1000; // characters\r\nexport const MAX_SESSION_TITLE_LENGTH = 100; // characters\r\nexport const MIN_SESSION_TITLE_LENGTH = 3; // characters\r\n\r\n// Session quality filters\r\nexport const MIN_MESSAGES_PER_SESSION = 3; // Minimum messages required to upload a session\r\n\r\n// API endpoints (configured from .env at build time)\r\n// Values are baked into the bundle during build\r\nexport const WEB_APP_URL = process.env.ZEST_WEB_APP_URL || \"http://localhost:3000\";\r\nexport const SUPABASE_URL = process.env.ZEST_SUPABASE_URL || \"\";\r\nexport const SUPABASE_ANON_KEY = process.env.ZEST_SUPABASE_ANON_KEY || \"\";\r\n\r\n// Claude project directories\r\nexport const CLAUDE_PROJECTS_DIR = join(homedir(), \".claude\", \"projects\");\r\n"
  ],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAMA;AACA,8BAAmB;;;ACDnB;AACA;;;ACHA;AACA;AAGO,IAAM,kBAAkB,KAAK,QAAQ,GAAG,cAAc;AACtD,IAAM,YAAY,KAAK,iBAAiB,OAAO;AAC/C,IAAM,WAAW,KAAK,iBAAiB,MAAM;AAC7C,IAAM,YAAY,KAAK,iBAAiB,OAAO;AAG/C,IAAM,eAAe,KAAK,iBAAiB,cAAc;AACzD,IAAM,cAAc,KAAK,iBAAiB,aAAa;AACvD,IAAM,WAAW,KAAK,UAAU,YAAY;AAG5C,IAAM,oBAAoB,KAAK,WAAW,cAAc;AACxD,IAAM,sBAAsB,KAAK,WAAW,qBAAqB;AACjE,IAAM,sBAAsB,KAAK,WAAW,qBAAqB;AAajE,IAAM,sBAAsB,KAAK,OAAO;AAexC,IAAM,sBAAsB,KAAK,QAAQ,GAAG,WAAW,UAAU;;;ADrCxE,MAAM,OAAO;AAAA,EACH,WAAqB;AAAA,EAErB,SAAmC;AAAA,IACzC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,MAAM;AAAA,IACN,OAAO;AAAA,EACT;AAAA,EAEA,QAAQ,CAAC,OAAuB;AAAA,IAC9B,KAAK,WAAW;AAAA;AAAA,OAGJ,YAAW,CAAC,SAAgC;AAAA,IACxD,IAAI;AAAA,MACF,MAAM,MAAM,QAAQ,QAAQ,GAAG,EAAE,WAAW,KAAK,CAAC;AAAA,MAClD,MAAM,YAAY,IAAI,KAAK,EAAE,YAAY;AAAA,MACzC,MAAM,WAAW,UAAU,IAAI,cAAc;AAAA,GAAa,OAAO;AAAA,MACjE,OAAO,OAAO;AAAA,MAEd,QAAQ,MAAM,gCAAgC,KAAK;AAAA;AAAA;AAAA,EAI/C,SAAS,CAAC,OAA0B;AAAA,IAC1C,OAAO,KAAK,OAAO,UAAU,KAAK,OAAO,KAAK;AAAA;AAAA,EAGhD,KAAK,CAAC,YAAoB,MAAuB;AAAA,IAC/C,IAAI,KAAK,UAAU,OAAO,GAAG;AAAA,MAE3B,KAAK,YAAY,UAAU,WAAW,KAAK,SAAS,IAAI,KAAK,UAAU,IAAI,IAAI,IAAI;AAAA,IACrF;AAAA;AAAA,EAGF,IAAI,CAAC,YAAoB,MAAuB;AAAA,IAC9C,IAAI,KAAK,UAAU,MAAM,GAAG;AAAA,MAE1B,KAAK,YAAY,SAAS,WAAW,KAAK,SAAS,IAAI,KAAK,UAAU,IAAI,IAAI,IAAI;AAAA,IACpF;AAAA;AAAA,EAGF,IAAI,CAAC,YAAoB,MAAuB;AAAA,IAC9C,IAAI,KAAK,UAAU,MAAM,GAAG;AAAA,MAE1B,QAAQ,KAAK,eAAe,WAAW,GAAG,IAAI;AAAA,MAC9C,KAAK,YAAY,SAAS,WAAW,KAAK,SAAS,IAAI,KAAK,UAAU,IAAI,IAAI,IAAI;AAAA,IACpF;AAAA;AAAA,EAGF,KAAK,CAAC,SAAiB,OAAuB;AAAA,IAC5C,IAAI,KAAK,UAAU,OAAO,GAAG;AAAA,MAE3B,QAAQ,MAAM,gBAAgB,WAAW,KAAK;AAAA,MAC9C,KAAK,YACH,UAAU,WAAW,iBAAiB,QAAQ,MAAM,QAAQ,KAAK,UAAU,KAAK,GAClF;AAAA,IACF;AAAA;AAEJ;AAEO,IAAM,SAAS,IAAI;;;ADrD1B,eAAsB,eAAe,CAAC,UAAiD;AAAA,EACrF,IAAI;AAAA,IAEF,MAAM,UAAU,SAAQ,QAAQ;AAAA,IAChC,MAAM,eAAe,QAAQ,OAAO;AAAA,IAGpC,MAAM,gBAAgB,MAAM,kBAAkB,YAAY;AAAA,IAG1D,MAAM,cAAc,oBAAoB,aAAa;AAAA,IACrD,MAAM,gBAAgB,iBAAiB,aAAa;AAAA,IAEpD,OAAO;AAAA,MACL,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA,OAAO,OAAO;AAAA,IACd,OAAO,MAAM,+BAA+B,KAAK;AAAA,IACjD,OAAO;AAAA;AAAA;AAQX,eAAe,iBAAiB,CAAC,WAAoC;AAAA,EACnE,QAAQ,eAAe,MAAa;AAAA,EACpC,QAAQ,gBAAS,MAAa;AAAA,EAE9B,IAAI,cAAc;AAAA,EAClB,MAAM,OAAO,QAAQ,GAAG;AAAA,EAGxB,MAAM,UAAU,CAAC,QAAQ,gBAAgB,uBAAuB,cAAc,QAAQ;AAAA,EAEtF,OAAO,gBAAgB,MAAM;AAAA,IAC3B,WAAW,UAAU,SAAS;AAAA,MAC5B,IAAI,WAAW,MAAK,aAAa,MAAM,CAAC,GAAG;AAAA,QACzC,OAAO;AAAA,MACT;AAAA,IACF;AAAA,IAGA,MAAM,aAAa,SAAQ,WAAW;AAAA,IACtC,IAAI,eAAe;AAAA,MAAa;AAAA,IAChC,cAAc;AAAA,EAChB;AAAA,EAGA,OAAO;AAAA;AAMT,SAAS,mBAAmB,CAAC,eAA+B;AAAA,EAE1D,MAAM,OAAO,WAAW,QAAQ,EAAE,OAAO,aAAa,EAAE,OAAO,KAAK;AAAA,EACpE,OAAO,aAAa,KAAK,UAAU,GAAG,EAAE;AAAA;AAM1C,SAAS,gBAAgB,CAAC,eAA+B;AAAA,EACvD,OAAO,SAAS,aAAa;AAAA;AAO/B,eAAsB,uBAAuB,CAC3C,aACA,QACkB;AAAA,EAGlB,OAAO,MAAM,gCAAgC,wBAAwB,QAAQ;AAAA,EAC7E,OAAO;AAAA;",
  "debugId": "A376EB6CCBB5159D64756E2164756E21",
  "names": []
}