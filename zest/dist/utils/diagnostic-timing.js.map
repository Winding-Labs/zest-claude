{
  "version": 3,
  "sources": ["..\\src\\utils\\diagnostic-timing.ts", "..\\src\\utils\\logger.ts", "..\\src\\config\\constants.ts"],
  "sourcesContent": [
    "/**\r\n * Diagnostic utilities for timing analysis\r\n *\r\n * Helps identify when Claude writes JSONL entries relative to hook execution\r\n */\r\n\r\nimport { stat } from \"node:fs/promises\";\r\nimport type { Stats } from \"node:fs\";\r\nimport { logger } from \"./logger.js\";\r\n\r\nexport interface FileTimingInfo {\r\n  path: string;\r\n  mtime: Date;\r\n  size: number;\r\n  timestamp: number; // when this snapshot was taken\r\n}\r\n\r\n/**\r\n * Capture file timing snapshot\r\n */\r\nexport async function captureFileSnapshot(filePath: string): Promise<FileTimingInfo> {\r\n  const stats = await stat(filePath);\r\n  return {\r\n    path: filePath,\r\n    mtime: stats.mtime,\r\n    size: stats.size,\r\n    timestamp: Date.now(),\r\n  };\r\n}\r\n\r\n/**\r\n * Compare two file snapshots and log differences\r\n */\r\nexport function logFileChanges(\r\n  before: FileTimingInfo,\r\n  after: FileTimingInfo,\r\n  context: string,\r\n): void {\r\n  const elapsed = after.timestamp - before.timestamp;\r\n  const sizeChange = after.size - before.size;\r\n  const mtimeChanged = after.mtime.getTime() !== before.mtime.getTime();\r\n\r\n  logger.info(`[TIMING] ${context} - Elapsed: ${elapsed}ms`);\r\n  logger.info(\r\n    `[TIMING] ${context} - File size: ${before.size} → ${after.size} (${sizeChange >= 0 ? \"+\" : \"\"}${sizeChange} bytes)`,\r\n  );\r\n  logger.info(`[TIMING] ${context} - mtime changed: ${mtimeChanged ? \"YES\" : \"NO\"}`);\r\n\r\n  if (mtimeChanged) {\r\n    logger.info(\r\n      `[TIMING] ${context} - mtime: ${before.mtime.toISOString()} → ${after.mtime.toISOString()}`,\r\n    );\r\n  }\r\n\r\n  if (sizeChange > 0) {\r\n    logger.warn(`[TIMING] ${context} - ⚠️ File grew by ${sizeChange} bytes during wait!`);\r\n  }\r\n}\r\n\r\n/**\r\n * Log missed content details for debugging\r\n */\r\nexport function logMissedContent(\r\n  messages: Array<{ role: string; content: string; message_index: number }>,\r\n  toolUses: Array<{ tool_name: string; file_path?: string }>,\r\n  context: string,\r\n): void {\r\n  if (messages.length === 0 && toolUses.length === 0) {\r\n    return;\r\n  }\r\n\r\n  logger.warn(\r\n    `[TIMING] ${context} - Found ${messages.length} missed messages, ${toolUses.length} missed tools`,\r\n  );\r\n\r\n  for (const msg of messages) {\r\n    const preview = msg.content.substring(0, 100).replace(/\\n/g, \" \");\r\n    logger.warn(\r\n      `[TIMING] ${context} - Missed message[${msg.message_index}]: role=${msg.role}, content=\"${preview}...\"`,\r\n    );\r\n  }\r\n\r\n  for (const tool of toolUses) {\r\n    logger.warn(\r\n      `[TIMING] ${context} - Missed tool: ${tool.tool_name} on ${tool.file_path || \"unknown\"}`,\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Wait with progress logging\r\n */\r\nexport async function waitWithLogging(ms: number, context: string): Promise<void> {\r\n  logger.debug(`[TIMING] ${context} - Waiting ${ms}ms for JSONL write to complete...`);\r\n  const start = Date.now();\r\n  await new Promise((resolve) => setTimeout(resolve, ms));\r\n  const elapsed = Date.now() - start;\r\n  logger.debug(`[TIMING] ${context} - Wait complete (actual: ${elapsed}ms)`);\r\n}\r\n",
    "/**\r\n * Logging utilities\r\n *\r\n * Handles logging to console and file system\r\n */\r\n\r\nimport { appendFile, mkdir } from \"node:fs/promises\";\r\nimport { dirname } from \"node:path\";\r\nimport { LOG_FILE } from \"../config/constants.js\";\r\n\r\ntype LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";\r\n\r\nclass Logger {\r\n  private minLevel: LogLevel = \"info\";\r\n\r\n  private levels: Record<LogLevel, number> = {\r\n    debug: 0,\r\n    info: 1,\r\n    warn: 2,\r\n    error: 3,\r\n  };\r\n\r\n  setLevel(level: LogLevel): void {\r\n    this.minLevel = level;\r\n  }\r\n\r\n  private async writeToFile(message: string): Promise<void> {\r\n    try {\r\n      await mkdir(dirname(LOG_FILE), { recursive: true });\r\n      const timestamp = new Date().toISOString();\r\n      await appendFile(LOG_FILE, `[${timestamp}] ${message}\\n`, \"utf-8\");\r\n    } catch (error) {\r\n      // Silently fail - don't crash if we can't write logs\r\n      console.error(\"Failed to write to log file:\", error);\r\n    }\r\n  }\r\n\r\n  private shouldLog(level: LogLevel): boolean {\r\n    return this.levels[level] >= this.levels[this.minLevel];\r\n  }\r\n\r\n  debug(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"debug\")) {\r\n      // Only write to file, don't clutter console\r\n      this.writeToFile(`DEBUG: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  info(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"info\")) {\r\n      // Only write to file, don't clutter console\r\n      this.writeToFile(`INFO: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  warn(message: string, ...args: unknown[]): void {\r\n    if (this.shouldLog(\"warn\")) {\r\n      // Show warnings to user\r\n      console.warn(`[Zest:Warn] ${message}`, ...args);\r\n      this.writeToFile(`WARN: ${message} ${args.length > 0 ? JSON.stringify(args) : \"\"}`);\r\n    }\r\n  }\r\n\r\n  error(message: string, error?: unknown): void {\r\n    if (this.shouldLog(\"error\")) {\r\n      // Show errors to user\r\n      console.error(`[Zest:Error] ${message}`, error);\r\n      this.writeToFile(\r\n        `ERROR: ${message} ${error instanceof Error ? error.stack : JSON.stringify(error)}`,\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport const logger = new Logger();\r\n",
    "/**\n * Application constants and configuration values\n */\n\nimport { homedir } from \"node:os\";\nimport { join } from \"node:path\";\n\n// Base directories\nexport const CLAUDE_ZEST_DIR = join(\n  homedir(),\n  `.claude-zest${process.env.NODE_ENV === \"development\" ? \"-dev\" : \"\"}`,\n);\nexport const QUEUE_DIR = join(CLAUDE_ZEST_DIR, \"queue\");\nexport const LOGS_DIR = join(CLAUDE_ZEST_DIR, \"logs\");\nexport const STATE_DIR = join(CLAUDE_ZEST_DIR, \"state\");\nexport const DELETION_CACHE_DIR = join(CLAUDE_ZEST_DIR, \"cache\", \"deletions\");\n\n// File paths\nexport const SESSION_FILE = join(CLAUDE_ZEST_DIR, \"session.json\"); // Auth session + workspace info\nexport const SETTINGS_FILE = join(CLAUDE_ZEST_DIR, \"settings.json\"); // User preferences\nexport const LOG_FILE = join(LOGS_DIR, \"plugin.log\");\nexport const SYNC_LOG_FILE = join(LOGS_DIR, \"sync.log\");\nexport const DAEMON_PID_FILE = join(CLAUDE_ZEST_DIR, \"daemon.pid\");\n\n// Queue files\nexport const EVENTS_QUEUE_FILE = join(QUEUE_DIR, \"events.jsonl\");\nexport const SESSIONS_QUEUE_FILE = join(QUEUE_DIR, \"chat-sessions.jsonl\");\nexport const MESSAGES_QUEUE_FILE = join(QUEUE_DIR, \"chat-messages.jsonl\");\n\n// Platform and source identifiers\nexport const PLATFORM = \"terminal\";\nexport const SOURCE = \"claude-code\";\nexport const CLIENT_ID = \"claude-cli\";\n\n// Sync configuration\nexport const SYNC_INTERVAL_MS = 60000; // 60 seconds\nexport const MAX_RETRY_ATTEMPTS = 3;\nexport const RETRY_BACKOFF_MS = 5000;\n\n// File locking configuration\nexport const LOCK_RETRY_MS = 50; // Retry interval when lock is held by another process\nexport const LOCK_MAX_RETRIES = 200; // Max retries (10 seconds total)\n\n// Cache configuration\nexport const DELETION_CACHE_TTL_MS = 5 * 60 * 1000; // 5 minutes\n\n// Authentication configuration\nexport const PROACTIVE_REFRESH_THRESHOLD_MS = 5 * 60 * 1000; // Proactively refresh JWT/access tokens 5 minutes before expiration\n\n// Content size limits\nexport const MAX_DIFF_SIZE_BYTES = 10 * 1024 * 1024; // 10MB\nexport const MAX_CONTENT_PREVIEW_LENGTH = 1000; // characters\nexport const MAX_SESSION_TITLE_LENGTH = 100; // characters\nexport const MIN_SESSION_TITLE_LENGTH = 3; // characters\n\n// Session quality filters\nexport const MIN_MESSAGES_PER_SESSION = 3; // Minimum messages required to upload a session\nexport const STALE_SESSION_AGE_MS = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds\n\n// API endpoints (configured from .env at build time)\n// Values are baked into the bundle during build\nexport const WEB_APP_URL = process.env.ZEST_WEB_APP_URL || \"http://localhost:3000\";\nexport const SUPABASE_URL = process.env.ZEST_SUPABASE_URL || \"\";\nexport const SUPABASE_ANON_KEY = process.env.ZEST_SUPABASE_ANON_KEY || \"\";\n\n// Claude project directories\nexport const CLAUDE_PROJECTS_DIR = join(homedir(), \".claude\", \"projects\");\n\n// Filter patterns for commands/messages to exclude from tracking\nexport const EXCLUDED_COMMAND_PATTERNS = [\n  // Claude Code built-in commands\n  /^\\/(add-dir|agents|bashes|bug|clear|compact|config|context|cost|doctor|exit|export|help|hooks|ide|init|install-github-app|login|logout|mcp|memory|model|output-style|permissions|plugin|pr-comments|privacy-settings|release-notes|resume|review|rewind|sandbox|security-review|stats|status|statusline|terminal-setup|todos|usage|vim)\\b/i,\n\n  // Zest plugin commands (like /zest:status, /zest-dev:status, etc.)\n  /^\\/zest[^:\\s]*:/i,\n\n  // Messages containing Zest command tags (e.g., <command-name>/zest-dev:status</command-name>)\n  /<command-name>\\/zest[^<]*<\\/command-name>/i,\n\n  // Messages containing Zest CLI script paths (e.g., \"node .../dist/commands/sync-cli.js\")\n  /node\\s+.*\\/dist\\/commands\\/.*-cli\\.js/i,\n];\n\nexport const ZEST_SESSION_NAMESPACE = \"1b671a64-40d5-491e-99b0-da01ff1f3341\";\n"
  ],
  "mappings": "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",
  "debugId": "C5B92D760E97754F64756E2164756E21",
  "names": []
}